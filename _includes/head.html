<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  {% seo %}
  <link rel="stylesheet" href="{{ "/assets/css/style.css" | relative_url }}">
  {% feed_meta %}
  {% if jekyll.environment == 'production' and site.google_analytics %}
    {% include google-analytics.html %}
  {% endif %}
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">

  <!-- KaTeX æ•°å­¦å…¬å¼æ”¯æŒ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
      onload="renderMathInElement(document.body, {
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ]
      });"></script>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  
  <script>
  (function() {
    // å½“ widget åŠ è½½å®Œæˆåæ‰§è¡Œ
    if (window.netlifyIdentity) {
      // ç›‘å¬ç™»å½•æˆåŠŸäº‹ä»¶
      window.netlifyIdentity.on('login', function(user) {
        // æ£€æŸ¥ sessionStorage ä¸­æ˜¯å¦ä¿å­˜äº†åŸå§‹è¯·æ±‚è·¯å¾„
        var redirectUrl = sessionStorage.getItem('redirectAfterLogin');
        if (redirectUrl) {
          sessionStorage.removeItem('redirectAfterLogin');
          window.location.href = redirectUrl;
        }
      });

      // å¦‚æœå½“å‰é¡µé¢æ˜¯å—ä¿æŠ¤é¡µé¢ï¼ˆä¾‹å¦‚ /feedback/ï¼‰ä¸”ç”¨æˆ·æœªç™»å½•ï¼Œä¿å­˜å½“å‰è·¯å¾„
      if (window.location.pathname.startsWith('/feedback/')) {
        // ç¨ç­‰ç‰‡åˆ»ä»¥ç¡®ä¿ widget åˆå§‹åŒ–å®Œæˆ
        setTimeout(function() {
          var user = window.netlifyIdentity.currentUser();
          if (!user) {
            sessionStorage.setItem('redirectAfterLogin', window.location.href);
            // ä¸éœ€è¦æ‰‹åŠ¨æ‰“å¼€ç™»å½•æ¡†ï¼ŒNetlify çš„ 401 å“åº”ä¼šè‡ªåŠ¨è§¦å‘
          }
        }, 500);
      }
    }
  })();
</script>
  
  <!-- ä¸»é¢˜åˆ‡æ¢è„šæœ¬ï¼ˆå·²ç§»å…¥ head å†…ï¼‰ -->
  <script>
    (function() {
      const html = document.documentElement;
      const toggleBtn = document.getElementById('theme-toggle');
      if (!toggleBtn) return;

      // è¯»å– localStorage ä¸­çš„ä¸»é¢˜è®¾ç½®
      let savedTheme = localStorage.getItem('theme') || 'auto'; // 'auto', 'dark', 'light'

      // åº”ç”¨ä¿å­˜çš„ä¸»é¢˜
      function applyTheme(theme) {
        html.classList.remove('theme-dark', 'theme-light');
        if (theme === 'dark') {
          html.classList.add('theme-dark');
          toggleBtn.textContent = 'ğŸŒ™ æ·±è‰²';
        } else if (theme === 'light') {
          html.classList.add('theme-light');
          toggleBtn.textContent = 'â˜€ï¸ æµ…è‰²';
        } else {
          // auto: è·Ÿéšç³»ç»Ÿï¼Œä¸æ·»åŠ ä»»ä½•å¼ºåˆ¶ç±»
          toggleBtn.textContent = 'ğŸŒ“ è‡ªåŠ¨';
        }
        localStorage.setItem('theme', theme);
      }

      applyTheme(savedTheme);

      // ç‚¹å‡»æŒ‰é’®å¾ªç¯åˆ‡æ¢ï¼šauto -> dark -> light -> auto
      toggleBtn.addEventListener('click', () => {
        let current = localStorage.getItem('theme') || 'auto';
        if (current === 'auto') {
          applyTheme('dark');
        } else if (current === 'dark') {
          applyTheme('light');
        } else {
          applyTheme('auto');
        }
      });
    })();
  </script>
</head>