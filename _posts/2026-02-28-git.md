---
layout: post
title: "Git 使用指南"
date: 2026-02-28
categories: [工程,技术]
author: agppd
---

## 1. 什么是 Git？

```Markdown
Git 由 Linus Torvalds 创建，用于 Linux 内核的开发。它具有以下特点：

- **分布式**：每个开发者都拥有完整的代码仓库历史，可以在本地进行所有操作，无需时刻联网。
- **分支支持强大**：轻量级分支让并行开发和实验变得非常简单。
- **数据完整性**：所有数据在存储前都会计算校验和，保证历史不可篡改。
```
——By Deepseek

## 2. 安装 Git

### Windows
- 访问 [git-scm.com](https://git-scm.com/download/win)，下载安装程序并运行，使用默认选项即可。
- 安装完成后，在开始菜单中找到 “Git Bash”，打开后即可使用 Git 命令。

### macOS
- 通过 Homebrew 安装：`brew install git`
- 或者下载官方安装程序：https://git-scm.com/download/mac

### Linux
- Debian/Ubuntu：`sudo apt update && sudo apt install git`
- Fedora：`sudo dnf install git`

安装后，在终端运行 `git --version` 验证是否成功。

## 3. 初始配置

使用 Git 前，需要设置用户名和邮箱，这些信息会记录在每次提交中。

```bash
git config --global user.name "你的名字"
git config --global user.email "你的邮箱@example.com"
```

`--global` 表示全局配置，如果想为单个项目设置不同信息，可以在项目目录下不使用 `--global` 重新配置。

其他常用配置：
- 设置默认编辑器（如 VSCode）：`git config --global core.editor "code --wait"`
- 查看所有配置：`git config --list`

## 4. 基本概念

Git 有三个主要区域：
- **工作区（Working Directory）**：你当前正在编辑的文件目录。
- **暂存区（Staging Area / Index）**：一个临时文件，保存了下次将要提交的文件列表。
- **本地仓库（Repository）**：Git 保存所有历史版本的地方，位于 `.git` 目录中。

基本工作流程：
1. 在工作区修改文件。
2. 将更改添加到暂存区（`git add`）。
3. 将暂存区的内容提交到本地仓库（`git commit`）。

## 5. 创建仓库

### 5.1 在现有项目中初始化
进入项目目录，执行：
```bash
git init
```
这会在当前目录创建一个 `.git` 隐藏文件夹，表示仓库已建立。

### 5.2 克隆远程仓库
如果项目已经存在于远程（如 GitHub、GitLab），可以用 `clone` 下载到本地：
```bash
git clone <仓库地址>
```
例如：`git clone https://github.com/用户名/仓库名.git`

## 6. 基本操作

### 6.1 查看状态
随时可以查看哪些文件被修改、哪些在暂存区：
```bash
git status
```

### 6.2 添加文件到暂存区
- 添加单个文件：`git add 文件名`
- 添加所有更改：`git add .` 或 `git add -A`
- 添加当前目录所有更改（不包括上级）：`git add *`

### 6.3 提交更改
```bash
git commit -m "提交说明"
```
提交说明应简洁明了，描述本次改动的内容。

### 6.4 查看提交历史
```bash
git log
```
常用参数：
- `--oneline`：简洁显示（一行一个提交）
- `--graph`：以图形方式显示分支合并
- `-n 5`：只显示最近5条

### 6.5 查看文件差异
- 工作区与暂存区的差异：`git diff`
- 暂存区与最新提交的差异：`git diff --staged`
- 两个提交之间的差异：`git diff <提交1> <提交2>`

## 7. 分支管理

分支允许你在同一项目上并行开发多个功能。

### 7.1 查看分支
```bash
git branch          # 列出本地分支（当前分支前有 *）
git branch -r       # 列出远程分支
git branch -a       # 列出所有分支
```

### 7.2 创建分支
```bash
git branch <分支名>
```

### 7.3 切换分支
```bash
git checkout <分支名>
# 或者新版命令
git switch <分支名>
```
创建并切换到新分支（一步完成）：
```bash
git checkout -b <分支名>
# 或
git switch -c <分支名>
```

### 7.4 合并分支
假设你现在在 `main` 分支，想把 `feature` 分支的改动合并过来：
```bash
git merge feature
```
Git 会自动尝试合并，如果出现冲突，需要手动解决。

### 7.5 解决合并冲突
当两个分支修改了同一文件的同一部分时，合并会产生冲突。Git 会在文件中标记冲突区域：
```
<<<<<<< HEAD
当前分支的内容
=======
合并进来的分支的内容
>>>>>>> feature
```
你需要手动编辑文件，保留正确的内容，然后保存，并执行：
```bash
git add <文件名>
git commit -m "解决合并冲突"
```

### 7.6 删除分支
- 删除本地分支：`git branch -d <分支名>`（如果分支未合并，需要 `-D` 强制删除）
- 删除远程分支：`git push origin --delete <分支名>`

## 8. 远程仓库

### 8.1 关联远程仓库
如果本地仓库已存在，添加远程仓库地址：
```bash
git remote add origin <远程仓库URL>
```
`origin` 是远程仓库的默认别名，可自定义。

### 8.2 推送更改到远程
```bash
git push -u origin main
```
`-u` 选项会将本地 `main` 分支与远程 `main` 分支建立追踪关系，之后只需 `git push` 即可。

### 8.3 拉取远程更新
```bash
git pull
```
这相当于 `git fetch`（获取远程更新） + `git merge`（合并到当前分支）。  
如果只想先获取但不合并，使用 `git fetch`。

### 8.4 查看远程仓库信息
```bash
git remote -v
```

### 8.5 使用 GitHub 个人访问令牌（Token）

从 2021 年 8 月起，GitHub 不再接受账户密码进行 Git 操作，推荐使用**个人访问令牌**或 SSH 密钥进行身份验证。以下是如何生成和使用令牌的方法。

#### 为什么要用令牌？
- 更安全：可以限制令牌的权限（如只读、只访问特定仓库）和有效期。
- 便于撤销：如果怀疑令牌泄露，可以在 GitHub 上随时吊销，无需更改密码。

#### 如何生成 GitHub 个人访问令牌
1. 登录 GitHub，点击右上角头像 → **Settings**。
2. 在左侧边栏选择 **Developer settings**。
3. 点击 **Personal access tokens** → **Tokens (classic)**。
4. 点击 **Generate new token** → **Generate new token (classic)**。
5. 为令牌填写描述（如“我的电脑 Git 令牌”），并选择权限范围（scopes）：
   - 如果需要操作仓库，至少勾选 **repo**。
   - 如果需要管理 GitHub Actions 工作流，勾选 **workflow**。
   - 其他按需选择。
6. 点击页面底部的 **Generate token**，**立即复制生成的令牌**（页面刷新后将无法再次看到）。

#### 如何使用令牌

**方式一：在命令行交互式输入**

当执行 `git push`、`git pull` 等操作提示输入用户名和密码时：
- 用户名：输入你的 GitHub 用户名
- 密码：**粘贴令牌**（而不是你的登录密码）

**方式二：在远程仓库 URL 中直接嵌入令牌**（不推荐，因为令牌会明文保存在历史中或配置文件中，有泄露风险）
```bash
git clone https://<token>@github.com/用户名/仓库名.git
```
或修改已有仓库的远程地址：
```bash
git remote set-url origin https://<token>@github.com/用户名/仓库名.git
```

**方式三：使用 Git 凭证助手缓存令牌**

为了避免每次操作都输入令牌，可以配置 Git 长期存储凭证：
- 在 Windows 上，Git 默认会使用 **Git Credential Manager**，首次输入令牌后会自动存储。
- 在 macOS 上，可以使用钥匙串。
- 在 Linux 上，可以启用缓存：
  ```bash
  git config --global credential.helper cache
  # 默认缓存 15 分钟，可设置较长时间（单位：秒）
  git config --global credential.helper 'cache --timeout=3600'
  ```
  或者使用 libsecret（需要安装）等更安全的存储方式。

推荐在 Windows 和 macOS 上保持默认的凭证助手，在首次推送时输入一次令牌即可。

#### 其他注意事项
- 令牌相当于密码，请妥善保管，不要分享或提交到代码仓库。
- 如果令牌过期或泄露，可以在 GitHub 上删除并重新生成。

除了令牌，也可以使用 SSH 密钥进行认证，配置方法可参考 GitHub 官方文档。

## 9. 撤销更改

### 9.1 撤销工作区的修改（未 `add`）
```bash
git restore <文件名>
# 或老命令
git checkout -- <文件名>
```
这会丢弃工作区中对文件的修改，恢复到最近一次 `git add` 或 `git commit` 的状态。

### 9.2 撤销暂存区的文件（已 `add`，未 `commit`）
```bash
git restore --staged <文件名>
```
将文件从暂存区移回工作区，但保留修改内容。

### 9.3 修改最后一次提交（已 `commit`，未 `push`）
```bash
git commit --amend -m "新的提交信息"
```
如果暂存区有新的修改，也可以一并合并到上一次提交中（先 `add`，再 `--amend`）。

### 9.4 回退到历史版本
```bash
git reset --hard <提交ID>
```
这会彻底丢弃该提交之后的所有更改，慎用！如果只想回退但保留修改内容，可以用 `--soft` 或 `--mixed`。

### 9.5 找回丢失的提交
如果不小心用 `reset` 弄丢了提交，`git reflog` 可以查看所有 HEAD 移动的历史，找到丢失的提交 ID，再通过 `reset` 或 `checkout` 恢复。

## 10. 标签

标签用于标记重要的版本（如发布点）。

- 创建轻量标签：`git tag v1.0.0`
- 创建附注标签（推荐）：`git tag -a v1.0.0 -m "版本1.0.0发布"`
- 查看所有标签：`git tag`
- 推送标签到远程：`git push origin v1.0.0`（或 `--tags` 推送所有标签）
- 删除标签：`git tag -d v1.0.0`（本地），`git push origin --delete v1.0.0`（远程）

## 11. 忽略文件

在项目根目录创建 `.gitignore` 文件，列出不需要 Git 跟踪的文件和目录模式。例如：

```
# 编译输出
/target/
*.class

# IDE 配置
.idea/
.vscode/

# 日志文件
*.log

# 环境配置文件
.env
```

规则可参考 [gitignore 模板](https://github.com/github/gitignore)。


## 12. 注意事项与最佳实践

- **提交信息清晰**：使用动词开头（如“添加登录功能”），长度不超过50字，详细内容可另起一行。
- **频繁提交**：小而独立的提交便于追踪和回退。
- **不要提交敏感信息**：密码、密钥、令牌等绝对不要进入版本库。
- **及时拉取更新**：推送前先 `git pull` 避免冲突。
- **使用 `.gitignore`**：忽略编译产物和临时文件，保持仓库整洁。
- **理解而非复制命令**：多思考每个命令的作用。

## 13. 总结与进一步学习

本指南涵盖了 Git 的日常核心操作，并特别说明了如何使用 GitHub 个人访问令牌进行身份验证。掌握这些，你已经可以胜任绝大多数开发场景。如果想深入学习，推荐：

- 官方文档：[git-scm.com/doc](https://git-scm.com/doc)
- 在线练习：[Learn Git Branching](https://learngitbranching.js.org/)
- 书籍：《Pro Git》（免费在线阅读：https://git-scm.com/book/zh/v2）